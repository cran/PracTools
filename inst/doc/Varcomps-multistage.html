<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Richard Valliant, Jill A. Dever, and Frauke Kreuter" />

<meta name="date" content="2023-11-29" />

<title>Variance Component Estimation in Multistage Sampling</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Variance Component Estimation in Multistage
Sampling</h1>
<h4 class="author">Richard Valliant, Jill A. Dever, and Frauke
Kreuter</h4>
<h4 class="date">2023-11-29</h4>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<p>To allocate a sample among different stages of sampling, the
contributions of the different stages to the variance of an estimator
must be considered. These components of variance generally depend on the
analysis variable and also on the form of the estimator. This vignette
covers some basic variance results for linear estimators in two-stage
and three-stage sampling and how the components can be estimated with
functions in <code>PracTools</code>. Technical background is in <span class="citation">Valliant, Dever, and Kreuter (2018b)</span>, ch.9.
First, the package must be loaded with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(PracTools)</span></code></pre></div>
<p>Alternatively, <code>require(PracTools)</code> can be used.</p>
<div id="two-stage-sampling" class="section level2">
<h2>Two-stage Sampling</h2>
<p>Consider a two-stage sample design in which the first-stage units are
selected using <span class="math inline">\(\pi ps\)</span> sampling,
i.e., with varying probabilities and without replacement. We will also
refer to this as <em>ppswor</em> sampling. Elements are selected at the
second stage via simple random sampling without replacement
(<em>srswor</em>). Quite a bit of notation is needed, even in this
fairly simple case:</p>
<p><span class="math inline">\(\small U\)</span> = universe of PSUs</p>
<p><span class="math inline">\(\small M\)</span> = number of PSUs in
universe</p>
<p><span class="math inline">\(\small U_{i}\)</span> = universe of
elements in PSU <span class="math inline">\(\small i\)</span></p>
<p><span class="math inline">\(\small N_{i}\)</span> = number of
elements in the population for PSU <span class="math inline">\(\small
i\)</span></p>
<p><span class="math inline">\(\small N=\sum _{i\in U}N_{i}\)</span> is
the total number of elements in the population</p>
<p><span class="math inline">\(\small \pi_{i}\)</span> = selection
probability of PSU <span class="math inline">\(\small i\)</span></p>
<p><span class="math inline">\(\small \pi_{ij}\)</span> = joint
selection probability of PSUs <span class="math inline">\(\small
i\)</span> and <span class="math inline">\(\small j\)</span></p>
<p><span class="math inline">\(\small m\)</span> = number of sample
PSUs</p>
<p><span class="math inline">\(\small n_{i}\)</span> = number of sample
elements in PSU <span class="math inline">\(\small i\)</span></p>
<p><span class="math inline">\(\small s\)</span> = set of sample
PSUs</p>
<p><span class="math inline">\(\small s_{i}\)</span> = set of sample
elements in PSU <span class="math inline">\(\small i\)</span></p>
<p><span class="math inline">\(\small y_{k}\)</span> = analysis variable
for element <span class="math inline">\(\small k\)</span> in PSU <span class="math inline">\(\small i\)</span> (subscript <span class="math inline">\(\small i\)</span> is implied)</p>
<p><span class="math inline">\(\small \bar{y}_{U}\)</span> = mean per
element in the population</p>
<p><span class="math inline">\(\small \bar{y}_{Ui}\)</span> = mean per
element in the population in PSU <span class="math inline">\(\small
i\)</span></p>
<p>The <span class="math inline">\(\small \pi\)</span>-estimator of the
population total, <span class="math inline">\(\small t_{U} =\sum _{i\in
U}\sum _{k\in U_{i} }y_{k}\)</span>, of an analysis variable <span class="math inline">\(\small y\)</span> is</p>
<p><span class="math display">\[\small \hat{t}_{\pi } =\sum _{i\in
s}\frac{\hat{t}_{i} }{\pi _{i} }\]</span></p>
<p>where <span class="math inline">\(\small \hat{t}_{i} =\left({N_{i}/
n_{i} } \right)\sum _{k\in s_{i} }y_{k}\)</span>, which is the estimate
of the total for PSU <span class="math inline">\(\small i\)</span> with
a simple random sample. The design variance of the estimated total can
be written as the sum of two components: <span class="math display">\[\begin{equation} \label{eq:pivar}
\small {V}\left(\hat{t}_{\pi } \right)=\sum _{i\in U}\sum _{j\in
U}\left(\pi _{ij} -\pi _{i} \pi _{j} \right)\frac{t_{i} }{\pi _{i} }
\frac{t_{j} }{\pi _{j} }   +\sum _{i\in U}\frac{N_{i} ^{2} }{\pi _{i}
n_{i} } \left(1-\frac{n_{i} }{N_{i} } \right)S_{U2i}^{2}
\end{equation}\]</span> where</p>
<p><span class="math display">\[\small S_{U2i}^{2} = \sum_{k\in U_{i}
}\left(y_{k} -\bar{y}_{Ui} \right)^{2}  / \left(N_{i} -1\right)
\]</span></p>
<p>is the unit variance of <span class="math inline">\(\small y\)</span>
among the elements in PSU <span class="math inline">\(\small
i\)</span>.</p>
<p>Formula <span class="math inline">\(\small \eqref{eq:pivar}\)</span>
is difficult or impossible to use for sample size computations because
the number of PSUs in the sample is not exposed. Another is to analyze
<em>srswor</em> sampling of PSUs and SSUs as in Example 1 below.
Determining sample sizes this way does not mean that you are necessarily
locked into selecting PSUs and elements within PSUs via <em>srswor</em>
or <em>srswr</em>. Basing sample sizes on a design that is less
complicated than the one that will actually be used is a common
approach, although it can be deceptive for some analysis variables.</p>
<div id="special-case-srswor-at-first-and-second-stages" class="section level3">
<h3>Special case: <em>srswor</em> at first and second stages</h3>
<p>Suppose the first stage is an <em>srswor</em> of <span class="math inline">\(\small m\)</span> out of <span class="math inline">\(\small M\)</span> PSUs and the second stage is a
sample of <span class="math inline">\(\small n_{i}\)</span> elements
selected by <em>srswor</em> from the population of <span class="math inline">\(\small N_{i}\)</span>. The <span class="math inline">\(\small \pi\)</span>-estimator is</p>
<p><span class="math display">\[
\small \hat{t}_{\pi} = \frac{M}{m} \sum_{i \in s} \frac{N_{i} }{n_{i} }
\sum_{k \in s_{i} } y_{k}
\]</span></p>
<p>Its variance is equal to <span class="math display">\[\begin{equation} \label{srs.relvar.gen}
   \small V\left(\hat{t}_{\pi } \right)=\frac{M^{2} }{m} \frac{M-m}{M}
S_{U1}^{2} +\frac{M}{m} \sum _{i\in U}\frac{N_{i}^{2} }{n_{i} }
\frac{N_{i} -n_{i} }{N_{i} } S_{U2i}^{2}
\end{equation}\]</span> where <span class="math inline">\(\small
S_{U1}^{2} =\frac{\sum _{i\in U}\left(t_{i} -\bar{t}_{U}
\right)^{2}}{M-1}\)</span> with <span class="math inline">\(t_{i}\)</span> being the population total of <span class="math inline">\(\small y\)</span> in PSU <span class="math inline">\(\small i\)</span> and <span class="math inline">\(\small \bar{t}_{U} ={\sum _{i\in U}t_{i} /
M}\)</span> is the mean total per PSU.</p>
<p>If <span class="math inline">\(\bar{n}\)</span> elements are selected
in each PSU and the sampling fractions of PSUs and elements within PSUs
are all small, then the relvariance can be written as <span class="math display">\[\begin{equation} \label{eq:relvarsrs}
  \small \frac{V(\hat{t}_{\pi})}{t_{U}^2} = \frac{B^2}{m} +
\frac{W^2}{m\bar{n}}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\small B^{2} ={S_{U1}^{2} /
\bar{t}_{U}^{2} = M^{2}S_{U1}^2/t_{U}^2 }\)</span> is the unit
relvariance among PSU totals and <span class="math inline">\(\small
W^{2} = M \sum _{i\in U}N_{i}^{2} S_{U2i}^{2}/t_{U}^2\)</span>. The term
<span class="math inline">\(\small B^{2}\)</span> is called the “between
(PSU) component” while <span class="math inline">\(\small W^{2}\)</span>
is the “within component”. Expression <span class="math inline">\(\small
\eqref{eq:relvarsrs}\)</span> is the form used in the R function,
<code>BW2stageSRS</code>. Textbooks often list a specialized form of
<span class="math inline">\(\small \eqref{eq:relvarsrs}\)</span> that
requires that all PSUs have the same size, <span class="math inline">\(\small N_i \equiv \bar{N}\)</span>, and that <span class="math inline">\(\small \bar{n}\)</span> elements are selected in
each. In that case, the second-stage sampling fraction is <span class="math inline">\({\bar{n} / \bar{N}}\)</span>. This implies that
the sample is self-weighting: <span class="math inline">\(\small \pi
_{i} \pi _{k\left|i\right. } = m\bar{n}/M\bar{N}\)</span>. The
relvariance based on <span class="math inline">\(\small
\eqref{srs.relvar.gen}\)</span> then simplifies to the less general form
<span class="math display">\[\begin{equation} \notag
   \small \frac{V(\hat{t}_{\pi})}{t_{U}^2} = \frac{1}{m} \frac{M-m}{M}
B^{2} +\frac{1}{m\bar{n}} \frac{\bar{N}-\bar{n}}{\bar{N}} W^{2} \notag
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\small W^{2}
=\frac{1}{M\bar{y}_{U}^{2} } \sum _{i\in U}S_{U2i}^{2}\)</span>.</p>
<p>Assuming that <span class="math inline">\(\small \bar{n}\)</span>
elements are selected in each sample PSU, and <span class="math inline">\(\small m/M\)</span> and <span class="math inline">\(\small \bar{n}/N_{i}\)</span> are both small, the
more general form of the relvariance in <span class="math inline">\(\small \eqref{eq:relvarsrs}\)</span> can also be
written in terms of a measure of homogeneity <span class="math inline">\(\small \delta\)</span> as follows:</p>
<p><span class="math display">\[\begin{equation} \label{eq:deltavar.2st}
   \small \frac{V\left(\hat{t}_{\pi } \right)}{t_{U}^{2} } \doteq
\frac{\tilde{V}}{m\bar{n}} k \left[1+\delta
\left(\bar{n}-1\right)\right]
\end{equation}\]</span> where <span class="math inline">\(\small
\tilde{V}= S_{U}^2/\bar{y}_{U}^{2}\)</span>, <span class="math inline">\(\small k=(B^2 + W^2)/\tilde{V}\)</span>, and</p>
<p><span class="math display">\[\begin{equation} \label{eq:delta}
   \small \delta = \frac{B^{2} }{B^{2} +W^{2} }.
\end{equation}\]</span> With some effort, it can be shown that when
<span class="math inline">\(\small N_{i}=\bar{N}\)</span> and both <span class="math inline">\(\small M\)</span> and <span class="math inline">\(\small \bar{N}\)</span> are large,</p>
<p><span class="math display">\[\begin{equation}
  \small \frac{S_{U}^{2} }{\bar{y}_{U}^{2} }  =
{\frac{1}{\bar{y}_{U}^{2} } \frac{\sum _{i\in U}\sum _{k\in
U_{i}}\left(y_{k} -\bar{y}_{U} \right)^{2} }{\left(N-1\right)} } \notag
\\
  \small {\doteq B^{2} +W^{2} } \notag
\end{equation}\]</span> i.e., the population relvariance can be written
as the sum of between and within relvariances. If <span class="math inline">\(\small k=1\)</span>, <span class="math inline">\(\small \eqref{eq:deltavar.2st}\)</span> equals the
expression found in many textbooks. However, when the population count
of elements per cluster varies, <span class="math inline">\(\small
k\)</span> may be far from 1, as will be illustrated in an example
below. In those cases, <span class="math inline">\(\small
\eqref{eq:deltavar.2st}\)</span> with an estimate of the actual <span class="math inline">\(\small k\)</span> should be used for determining
sample sizes and computing advance estimates of coefficients of
variation.</p>
<p>Expressions <span class="math inline">\(\small
\eqref{eq:relvarsrs}\)</span> and <span class="math inline">\(\small
\eqref{eq:deltavar.2st}\)</span> are useful for sample size calculation
since the number of sample PSUs and sample units per PSU are explicit in
the formula. Equation <span class="math inline">\(\small
\eqref{eq:deltavar.2st}\)</span> also connects the variance of the
estimated total to the variance that would be obtained from a simple
random sample since <span class="math inline">\(\small
\tilde{V}/m\bar{n}\)</span> is the relvariance of the estimated total in
an <em>srswor</em> of size <span class="math inline">\(\small
m\bar{n}\)</span> when the sampling fraction is small. The product <span class="math inline">\(\small k[1 + \delta(\bar{n}-1)]\)</span> is a type
of design effect. When <span class="math inline">\(\small k=1\)</span>,
the term <span class="math inline">\(\small 1+\delta
\left(\bar{n}-1\right)\)</span> is the approximate design effect found
in many textbooks.</p>
<p>The next example uses the <code>MDarea.popA</code> from
<code>PracTools</code>. This dataset is based on the U.S. Census counts
from the year 2000 for Anne Arundel County in the US state of Maryland.
The geographic divisions used in this dataset are called tracts and
block groups. Tracts are constructed by the US Census Bureau to have a
desired population size of 4,000 people. Block groups (BGs) are smaller
with a target size of 1,500 people. Counts of persons in the dataset are
the same for most tracts and block groups as in the 2000 Census.</p>
<ul>
<li><strong>Example. Between and within variance components in
<em>srs/srs</em> design</strong> The R function <code>BW2stageSRS</code>
will calculate the unit relvariance of a population, <span class="math inline">\(\small B^{2} + W^{2}\)</span> for comparison, the
ratio <span class="math inline">\(\small
k=(B^2+W^2)/(S_{U}^{2}/\bar{y}_{U}^2)\)</span>, and the full version of
<span class="math inline">\(\small \delta\)</span> in <span class="math inline">\(\small \eqref{eq:delta}\)</span>. The function
assumes that the entire sampling frame is an input. The full R code for
this example is in the file <code>Example 9.2.R</code>, available at
<span class="citation">Valliant, Dever, and Kreuter (2018a)</span>. We
first compute the results using the <code>PSU</code> and
<code>SSU</code> variables as clusters. These fields are created so that
all <code>PSU</code>s have the same size; likewise, all
<code>SSU</code>s have the same size. For the variable <code>y1</code>
in the Maryland population, the code is</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a> <span class="fu">require</span>(PracTools)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a> <span class="fu">data</span>(MDarea.popA)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a> <span class="fu">BW2stageSRS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>PSU)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; 0.007979563 1.455575239 1.463117997 1.463554802 1.000298544 0.005452179</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a> <span class="fu">BW2stageSRS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>SSU)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;  0.03661379  1.42824599  1.46311800  1.46485978  1.00119046  0.02499474</span></span></code></pre></div>
<p>The values of <span class="math inline">\(\small \delta\)</span> are
0.005 for <code>PSU</code> and 0.025 for <code>SSU</code>. Next, to
illustrate the dramatic effect that varying sizes of clusters can have,
we compute the same statistics as above using tracts and block groups
(BGs) within tracts as clusters. These vary substantially in the number
of persons in each cluster. A new variable called <code>trtBG</code> is
computed since the values of the variable, <code>BLKGROUP</code>, are
nested within each tract:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>   trtBG <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">*</span>MDarea.popA<span class="sc">$</span>TRACT <span class="sc">+</span> MDarea.popA<span class="sc">$</span>BLKGROUP</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>   <span class="fu">BW2stageSRS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>TRACT)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt;   0.2603356   1.8405833   1.4631180   2.1009189   1.4359190   0.1239151</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>   <span class="fu">BW2stageSRS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">psuID=</span>trtBG)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt;   0.3495410   1.9488250   1.4631180   2.2983660   1.5708685   0.1520824</span></span></code></pre></div>
<p>The value of <span class="math inline">\(\small \delta\)</span> is
0.124 <code>TRACT</code>s are clusters and 0.152 when <code>trtBG</code>
defines clusters. The measures of homogeneity increase substantially
when tracts or BGs are clusters compared to the <code>PSU</code> and
<code>SSU</code> results. This is entirely due to the increase in <span class="math inline">\(\small B^{2}\)</span> when units with highly
variable sizes are used and an <em>srs</em> is selected. For example,
<span class="math inline">\(\small B^{2} =0.0079\)</span> for
<code>y1</code> when <code>PSU</code> is a cluster but is 0.2605 when
<code>TRACT</code> is a cluster.</p>
</div>
<div id="more-general-two-stage-designs" class="section level3">
<h3>More General Two-stage Designs</h3>
<p>Variances of estimators in two-stage designs more complicated than
simple random sampling at each stage can be written as a sum of
components. However, these have limited usefulness in determining sample
sizes for the same reason that <span class="math inline">\(\small
\eqref{eq:pivar}\)</span> is not. A more convenient formulation is the
case where PSUs are selected with varying probabilities but with
replacement, and the sample within each PSU is selected by
<em>srswor</em>. With-replacement designs may not often be used in
practice but have simple variance formulae. The <em>pwr</em>-estimator
of a total <span class="citation">(Särndal, Swensson, and Wretman
1992)</span> is <span class="math display">\[
\small \hat{t}_{pwr} =\frac{1}{m} \sum _{i\in s}\frac{\hat{t}_{i}
}{p_{i} }
\]</span> where <span class="math inline">\(\small \hat{t}_{i}
=\frac{N_{i} }{n_{i} } \sum _{k\in s_{i} }y_{k}\)</span> is the
estimated total for PSU <span class="math inline">\(\small i\)</span>
from a simple random sample and <span class="math inline">\(\small
p_{i}\)</span> is the one-draw selection probability of PSU <span class="math inline">\(\small i\)</span>. The variance of <span class="math inline">\(\small \hat{t}_{pwr}\)</span> is</p>
<p><span class="math display">\[\begin{equation} \label{eq:v2st}
   \small V\left(\hat{t}_{pwr} \right)=\frac{1}{m} \sum _{i\in U}p_{i}
\left(\frac{t_{i} }{p_{i} } -t_{U} \right)^{2}  +\sum _{i\in
U}\frac{N_{i} ^{2} }{mp_{i} n_{i} } \left(1-\frac{n_{i} }{N_{i} }
\right)S_{U2i}^{2}.
\end{equation}\]</span></p>
<p>Making the assumption that <span class="math inline">\(\small
\bar{n}\)</span> elements are selected in each PSU, the variance reduces
to <span class="math display">\[
\small V\left(\hat{t}_{pwr} \right)=\frac{S_{U1\left(pwr\right)}^{2}
}{m} +\frac{1}{m\bar{n}} \sum _{i\in U}\left(1-\frac{\bar{n}}{N_{i} }
\right)\frac{N_{i}^{2} S_{U2i}^{2} }{p_{i} }
\]</span> where, in this case, <span class="math inline">\(S_{U1\left(pwr\right)}^{2} =\sum _{i\in U}p_{i}
\left(\frac{t_{i} }{p_{i} } -t_{U} \right)^{2}\)</span>. Dividing this
by <span class="math inline">\(t_{U}^{2}\)</span> and assuming that the
within-PSU sampling fraction, <span class="math inline">\(\bar{n} /
N_{i}\)</span>, is negligible, we obtain the relvariance of <span class="math inline">\(\hat{t}_{pwr}\)</span> as, approximately, <span class="math display">\[\begin{equation} \label{eq:vpwr.2st}
   \small \frac{V\left(\hat{t}_{pwr} \right)}{t_{U}^{2} } \doteq
\frac{B^{2} }{m} +\frac{W^{2} }{m\bar{n}} =\frac{\tilde{V}}{m\bar{n}} k
\left[1+\delta \left(\bar{n}-1\right)\right]
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\small
\tilde{V}=S_{U}^2/\bar{y}_{U}^2\)</span>, <span class="math inline">\(\small k=(B^2 + W^2)/\tilde{V}\)</span>, <span class="math display">\[\begin{equation} \label{eq:B2.2st.pwr}
   \small B^{2} =\frac{S_{U1\left(pwr\right)}^{2} }{t_{U}^{2} } ,
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation} \label{eq:W2.2st.pwr}
   \small W^{2} =\frac{1}{t_{U}^{2} } \sum _{i\in U}N_{i}^{2}
\frac{S_{U2i}^{2} }{p_{i} },
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\label{eq:delta.2st.pwr}
   \small \delta =B^{2} \left/ \left(B^{2} +W^{2} \right) \right.
\end{equation}\]</span></p>
<p>Expression <span class="math inline">\(\small
\eqref{eq:vpwr.2st}\)</span> has the same form as <span class="math inline">\(\small \eqref{eq:deltavar.2st}\)</span> but with
different definitions of <span class="math inline">\(\small B^2\)</span>
and <span class="math inline">\(\small W^2\)</span>. Expression <span class="math inline">\(\small \eqref{eq:vpwr.2st}\)</span> also has the
interpretation of an <em>srs</em> variance of an unclustered variance,
<span class="math inline">\(\small \tilde{V}/m\bar{n}\)</span>, times a
design effect, <span class="math inline">\(\small k[1 +
\delta(\bar{n}-1)]\)</span>, in the same way that <span class="math inline">\(\small \eqref{eq:deltavar.2st}\)</span> did.</p>
<ul>
<li><strong>Example. Between and within variance components in
<em>ppswr/srs</em> design</strong> This example repeats the calculations
in the example above for the variables in the Maryland area population.
Assume that clusters will be selected proportional to the count of
persons in each cluster. The function <code>BW2stagePPS</code> computes
the population values of <span class="math inline">\(\small
B^{2}\)</span>, <span class="math inline">\(\small W^{2}\)</span>, and
<span class="math inline">\(\small \delta\)</span> shown in <span class="math inline">\(\small \eqref{eq:B2.2st.pwr}\)</span>, <span class="math inline">\(\small \eqref{eq:W2.2st.pwr}\)</span>, and <span class="math inline">\(\small \eqref{eq:delta.2st.pwr}\)</span> which are
appropriate for <em>ppswr</em> sampling of clusters. The code for
<code>y1</code> using <code>PSU</code> or <code>SSU</code> as clusters
is shown below. The variables, <code>pp.PSU</code> and
<code>pp.SSU</code>, hold the one-draw probabilities <span class="math inline">\(\small p_{i}\)</span> that appear in <span class="math inline">\(\small \eqref{eq:v2st}\)</span>:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a> pp.PSU <span class="ot">&lt;-</span> <span class="fu">table</span>(MDarea.popA<span class="sc">$</span>PSU) <span class="sc">/</span> <span class="fu">nrow</span>(MDarea.popA)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a> pp.SSU <span class="ot">&lt;-</span> <span class="fu">table</span>(MDarea.popA<span class="sc">$</span>SSU) <span class="sc">/</span> <span class="fu">nrow</span>(MDarea.popA)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a> <span class="fu">BW2stagePPS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.PSU, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>PSU)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 0.007878320 1.455574516 1.463117997 1.463452835 1.000228853 0.005383378</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a> <span class="fu">BW2stagePPS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.SSU, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>SSU)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;  0.03652265  1.42825477  1.46311800  1.46477742  1.00113417  0.02493392</span></span></code></pre></div>
<p>The code for PSUs that are tracts and block groups is</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a> pp.trt <span class="ot">&lt;-</span> <span class="fu">table</span>(MDarea.popA<span class="sc">$</span>TRACT) <span class="sc">/</span> <span class="fu">nrow</span>(MDarea.popA)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a> pp.BG <span class="ot">&lt;-</span> <span class="fu">table</span>(trtBG) <span class="sc">/</span> <span class="fu">nrow</span>(MDarea.popA)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a> <span class="fu">BW2stagePPS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.trt, <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>TRACT)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 0.009458290 1.454058071 1.463117997 1.463516361 1.000272271 0.006462716</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a> <span class="fu">BW2stagePPS</span>(MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.BG, <span class="at">psuID=</span>trtBG)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;          B2          W2 unit relvar       B2+W2           k       delta </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;  0.01643324  1.44797251  1.46311800  1.46440575  1.00088014  0.01122178</span></span></code></pre></div>
<p>The between term when clusters are defined by <code>PSU</code> is
about the same as when clusters are selected by <em>srs</em> because
<code>PSU</code>’s all have the same size. With PSUs being either tracts
or block groups in the <em>ppswr/srswor</em> design, the between term is
much smaller than the within, compared to the results in the
<em>srs/srs</em> example. For example, with <code>y1</code> and
<em>srs</em> sampling of tracts, <span class="math inline">\(\small
B^2=0.2604\)</span> but for <em>pps</em> sampling of tracts <span class="math inline">\(\small B^2=0.0091\)</span>.</p>
<p>When clusters are selected by <em>srs</em>, <span class="math inline">\(\small S_{U1}^{2}\)</span> is the variance of the
cluster totals around the average cluster total. In contrast, with
<em>pps</em> sampling of clusters, <span class="math inline">\(\small
S_{U1\left(pwr\right)}^{2}\)</span> is the variance of the estimated
population totals, <span class="math inline">\(\small t_{i} \left/ p_{i}
\right.\)</span> around the population total, <span class="math inline">\(\small t_{U}\)</span>. When clusters are selected
with probability proportional to <span class="math inline">\(\small
N_{i}\)</span>, then <span class="math inline">\(\small t_{i} \left/
p_{i} \right. = N_{i} \bar{y}_{Ui}\)</span>. If these one-cluster
estimates of the population total are fairly accurate, as they are here,
the <span class="math inline">\(\small B^{2}\)</span> term can be quite
small. This leads to much smaller values of <span class="math inline">\(\small \delta\)</span> in <em>pps</em> sampling of
clusters. This implies that the negative effect of clustering on the
variance is lessened for a design that selects clusters with <span class="math inline">\(\small pp(N_i)\)</span>. This kind of comparison
explains most practitioners’ preference for <em>pps</em> sampling of
clusters, especially when the clusters vary in population size.</p>
</div>
</div>
<div id="general-three-stage-designs" class="section level2">
<h2>General Three-stage Designs</h2>
<p>In the case of with-replacement sampling of PSUs with varying
probabilities and srswor at the second and third stages, the relvariance
can be written (with a few assumptions) in a form useful for sample size
calculations. Treating the case where SSUs are selected via srs (either
with or without replacement) is not too unrealistic since SSUs (like
block groups) are often created to have about the same population
sizes.</p>
<p>The variance formulae for a three-stage design with <em>ppswor</em>
selection of first-stage units is complex enough that it is not useful
for sample size planning. See <span class="citation">Valliant, Dever,
and Kreuter (2018b)</span>, sec. 9.2.4 for details. To obtain a simpler
formula, suppose that <span class="math inline">\(\small
\bar{n}\)</span> SSUs are sampled in each sample PSU, the sampling
fractions of SSUs in each PSU, <span class="math inline">\(\small
\bar{n} \left/ N_{i} \right.\)</span>, are small, and <span class="math inline">\(\small \bar{\bar{q}}\)</span> elements are
selected in each sample SSU. The relvariance of the
<em>pwr</em>-estimator is then</p>
<p><span class="math display">\[\begin{equation} \label{ZEqnNum518915}
   \small \frac{V\left(\hat{t}_{pwr} \right)}{t_{U}^{2} } = \frac{B^{2}
}{m} +\frac{W_{2}^{2} }{m\bar{n}} + \frac{W_{3}^{2} }{m\bar{n}{\kern
1pt} \bar{\bar{q}}},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\small B^{2}
=S_{U1\left(pwr\right)}^{2} \left/ t_{U}^{2} \right.\)</span> is given
by <span class="math inline">\(\small
\eqref{eq:B2.2st.pwr}\)</span>,</p>
<p><span class="math display">\[\begin{equation} \label{ZEqnNum344483}
   \small W_{2}^{2} = \frac{1}{t_{U}^{2} } \sum_{i\in U} N_{i}^{2}
S_{U2i}^{2} \left/ p_{i} \right. ;
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation} \label{ZEqnNum290646}
   \small W_{3}^{2} = \frac{1}{t_{U}^{2} } \sum _{i\in U} \frac{N_{i}
}{p_{i} } \sum_{j\in U_{i}} Q_{ij}^{2} S_{U3ij}^{2} .
\end{equation}\]</span></p>
<p>The relvariance can also be written in terms of two measures of
homogeneity:</p>
<p><span class="math display">\[\begin{equation} \label{ZEqnNum836300}
   \small \frac{V\left(\hat{t}_{pwr} \right)}{t_{U}^{2} } =
\frac{\tilde{V}}{m\bar{n}\bar{\bar{q}}} \left\{k_{1} \delta _{1}
\bar{n}\bar{\bar{q}}+k_{2} \left[1+\delta _{2}
\left(\bar{\bar{q}}-1\right)\right]\right\}
\end{equation}\]</span> where</p>
<p><span class="math inline">\(\small k_{1} =
(B^2+W^2)/\tilde{V}\)</span> with <span class="math inline">\(\small
\tilde{V} = \frac{1}{Q-1} \sum_{i\in U} \sum_{j \in U_{i} } \sum_{k\in
U_{ij} } \left(y_{k} - \bar{y}_{U} \right)^2 \left/ \bar{y}_U^2
\right.\)</span> is the unit relvariance of <span class="math inline">\(\small y\)</span> in the population.</p>
<p><span class="math inline">\(\small k_{2} = (W_{2}^2 +
W_{3}^2)/\tilde{V}\)</span></p>
<p><span class="math inline">\(\small\delta _{1} = B^2/(B^2 +
W^2)\)</span></p>
<p><span class="math inline">\(\small W^{2} = \frac{1}{t_{U}^{2} }
\sum_{i\in U} Q_{i}^{2} S_{U3i}^{2} \left/ p_{i} \right.\)</span> with
<span class="math inline">\(\small S_{U3i}^{2} =\frac{1}{Q_{i} -1} \sum
_{j\in U_{i} }\sum _{k\in U_{ij} }\left(y_{k} -\bar{y}_{Ui}
\right)^{2}\)</span> and <span class="math inline">\(\small \bar{y}_{Ui}
= \sum _{j\in U_{i} } \sum_{k\in U_{ij} }y_{k} \left/ Q_{i}
\right.\)</span>, i.e., <span class="math inline">\(\small
S_{U3i}^{2}\)</span> is the element-level variance among all elements in
PSU <span class="math inline">\(\small i\)</span></p>
<p><span class="math inline">\(\small \delta _{2} = W_{2}^2/(W_{2}^2 +
W_{3}^2)\)</span></p>
<p>Note that the term <span class="math inline">\(\small W^{2}\)</span>
in <span class="math inline">\(\small \delta_{1}\)</span> does not enter
the variance in <span class="math inline">\(\small
\eqref{ZEqnNum518915}\)</span> but is defined by analogy to the term in
two-stage sampling. If elements were selected directly from the sample
PSUs (instead of first sampling SSUs), then <span class="math inline">\(\small W^{2}\)</span> above would be the
appropriate within-PSU component.</p>
<p>The term <span class="math inline">\(\small \delta _{1}\)</span> is a
measure of the homogeneity among the PSU totals. If the estimate of the
population total from each PSU total, <span class="math inline">\(\small
t_{i} \left/ p_{i} \right.\)</span>, was exactly equal to the population
total, <span class="math inline">\(\small t_{U}\)</span>, then <span class="math inline">\(\small B^{2} =0\)</span> and <span class="math inline">\(\small \delta _{1} = 0\)</span>. That is, if the
variation within PSUs is much larger than the variation among PSU
totals, then <span class="math inline">\(\small \delta _{1}\)</span>
will be small; this is the typical situation in household surveys <em>if
PSUs all have about the same number of elements</em>. As we saw in the
earlier example, the condition of equal-sized PSUs can be critically
important to insure that <span class="math inline">\(\small
B^{2}\)</span> is small.</p>
<p>If the SSUs all have about the same totals, <span class="math inline">\(\small t_{ij}\)</span>, then <span class="math inline">\(\small W_{2}^{2}\)</span> will be small and <span class="math inline">\(\small \delta _{2} \doteq 0\)</span>. Although
attempts may be made to create SSUs that have about the same number of
elements <span class="math inline">\(\small Q_{ij}\)</span>, the totals
<span class="math inline">\(\small t_{ij}\)</span> of other variables
tend to vary, leading to values of <span class="math inline">\(\small
\delta _{2}\)</span> that are larger than those of <span class="math inline">\(\small \delta _{1}\)</span>.</p>
<p>The R function, <code>BW3stagePPS</code>, will calculate <span class="math inline">\(\small B^{2}\)</span>, <span class="math inline">\(\small W^{2}\)</span>, <span class="math inline">\(\small W_{2}^{2}\)</span>, <span class="math inline">\(\small W_{3}^{2}\)</span>, <span class="math inline">\(\small \delta _{1}\)</span>, and <span class="math inline">\(\small \delta _{2}\)</span> defined above for
<em>ppswr/srs/srs</em> and <em>srswr/srs/srs</em> sampling. The function
is appropriate if an entire frame is available and takes the following
parameters:</p>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><img width="100/"></td>
<td align="left"><img width="500/"></td>
</tr>
<tr class="even">
<td align="left"><code>X</code></td>
<td align="left">data vector; length is the number of elements in the
population.</td>
</tr>
<tr class="odd">
<td align="left"><code>pp</code></td>
<td align="left">vector of one-draw probabilities for the PSUs; length
is number of PSUs in population.</td>
</tr>
<tr class="even">
<td align="left"><code>psuID</code></td>
<td align="left">vector of PSU identification numbers. This vector must
be as long as X. Each element in a given PSU should have the same value
in psuID. PSUs must be in the same order as in X.</td>
</tr>
<tr class="odd">
<td align="left"><code>ssuID</code></td>
<td align="left">vector of SSU identification numbers. This vector must
be as long as X. Each element in a given SSU should have the same value
in ssuID. PSUs and SSUs must be in the same order as in X. ssuID should
have the form <code>psuID||(ssuID within PSU)</code>.</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Example. Variance components in three stage
<em>srswr/srs/srs</em> and <em>ppswr/srs/srs</em> designs</strong>. In
the Maryland population suppose that suppose that tracts and BGs within
tracts are the first- and second-stage units, and that persons are
elements in a three-stage design. All three stages are selected by
<em>srs</em>. The call to <code>BW3stagePPS</code> for the variable
<code>y1</code> in an <em>srswr/srs/srs</em> design is:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a> M <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(MDarea.popA<span class="sc">$</span>TRACT))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a> trtBG <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">*</span>MDarea.popA<span class="sc">$</span>TRACT <span class="sc">+</span> MDarea.popA<span class="sc">$</span>BLKGROUP</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a> pp.trt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>M,M)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a> <span class="fu">BW3stagePPS</span>(<span class="at">X=</span>MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.trt,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>       <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>TRACT, <span class="at">ssuID=</span>trtBG)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;           B           W          W2          W3 unit relvar          k1 </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;   0.2575952   1.8405833   0.2714429   2.1074463   1.4631180   1.4340460 </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;          k2      delta1      delta2 </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;   1.6259039   0.1227709   0.1141049</span></span></code></pre></div>
<p>We repeat the calculation but assuming <em>ppswr</em> sampling of
PSUs. The calculation for <code>y1</code> using tracts and block groups
as the first- and second-stage sampling units is done via this call:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a> trtBG <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">*</span>MDarea.popA<span class="sc">$</span>TRACT <span class="sc">+</span> MDarea.popA<span class="sc">$</span>BLKGROUP</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a> pp.trt <span class="ot">&lt;-</span> <span class="fu">table</span>(MDarea.popA<span class="sc">$</span>TRACT) <span class="sc">/</span> <span class="fu">nrow</span>(MDarea.popA)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a> <span class="fu">BW3stagePPS</span>(<span class="at">X=</span>MDarea.popA<span class="sc">$</span>y1, <span class="at">pp=</span>pp.trt,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>       <span class="at">psuID=</span>MDarea.popA<span class="sc">$</span>TRACT, <span class="at">ssuID=</span>trtBG)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;           B           W          W2          W3 unit relvar          k1 </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 0.009458290 1.454058071 0.272308839 1.685246592 1.463117997 1.000272271 </span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;          k2      delta1      delta2 </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; 1.337934080 0.006462716 0.139106579</span></span></code></pre></div>
<p>Notice that <span class="math inline">\(\small \delta_1 =
0.123\)</span> with <em>srs</em> sampling of tracts but is 0.006 when
tracts are sampled proportional to their population sizes.</p>
<p>An important practical, sample design problem that we do not cover in
this vignette is how to estimate variance components and measures of
homogeneity from a complex, multistage sample. This topic is covered in
detail in section 9.4 of <span class="citation">Valliant, Dever, and
Kreuter (2018b)</span>. The <code>PracTools</code> package includes a
variety of other functions relevant to two- and three-stage sampling
that are also not discussed in this vignette:</p>
<table>
<colgroup>
<col width="45%" />
<col width="54%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><img width="100/"></td>
<td align="left"><img width="500/"></td>
</tr>
<tr class="even">
<td align="left">BW2stagePPSe</td>
<td align="left">Estimate components of relvariance for a sample design
where primary sampling units (PSUs) are selected with <em>pps</em> and
elements are selected via <em>srs</em>. The input is a sample selected
in this way.</td>
</tr>
<tr class="odd">
<td align="left">BW3stagePPSe</td>
<td align="left">Estimate components of relvariance for a sample design
where primary sampling units (PSUs) are selected with probability
proportional to size with replacement (ppswr) and secondary sampling
units (SSUs) and elements within SSUs are selected via simple random
sampling (srs). The input is a sample selected in this way.</td>
</tr>
<tr class="even">
<td align="left">clusOpt2</td>
<td align="left">Compute the sample sizes that minimize the variance of
the <em>pwr</em>-estimator of a total in a two-stage sample.</td>
</tr>
<tr class="odd">
<td align="left">clusOpt2fixedPSU</td>
<td align="left">Compute the optimum number of sample elements per
primary sampling unit (PSU) for a fixed set of PSUs.</td>
</tr>
<tr class="even">
<td align="left">clusOpt3</td>
<td align="left">Compute the sample sizes that minimize the variance of
the <em>pwr</em>-estimator of a total in a three-stage sample.</td>
</tr>
<tr class="odd">
<td align="left">clusOpt3fixedPSU</td>
<td align="left">Compute the sample sizes that minimize the variance of
the <em>pwr</em>-estimator of a total in a three-stage sample when the
PSU sample is fixed.</td>
</tr>
<tr class="even">
<td align="left">CVcalc2</td>
<td align="left">Compute the coefficient of variation of an estimated
total in a two-stage design. Primary sampling units (PSUs) can be
selected either with probability proportional to size (<em>pps</em>) or
with equal probability. Elements are selected via simple random sampling
(<em>srs</em>).</td>
</tr>
<tr class="odd">
<td align="left">CVcalc3</td>
<td align="left">Compute the coefficient of variation of an estimated
total in a three-stage design. Primary sampling units (PSUs) can be
selected either with probability proportional to size (<em>pps</em>) or
with equal probability. Secondary units and elements within SSUs are
selected via simple random sampling (<em>srs</em>).</td>
</tr>
<tr class="even">
<td align="left">deff</td>
<td align="left">Compute the Kish, Henry, Spencer, or Chen-Rust design
effects.</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-SSW.1992" class="csl-entry">
Särndal, C.-E., B. Swensson, and J. Wretman. 1992. <em>Model Assisted
Survey Sampling</em>. New York: Springer-Verlag.
</div>
<div id="ref-VDK.2018a" class="csl-entry">
Valliant, R., J. A. Dever, and F. Kreuter. 2018a. <em>Files for 2nd
Edition of Practical Tools for Designing and Weighting Survey
Samples</em>. <a href="https://umd.app.box.com/v/PracTools2ndEdition">https://umd.app.box.com/v/PracTools2ndEdition</a>.
</div>
<div id="ref-VDK.2018" class="csl-entry">
———. 2018b. <em>Practical Tools for Designing and Weighting Survey
Samples</em>. 2nd ed. New York: Springer-Verlag.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
