<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="George Zipf and Richard Valliant" />

<meta name="date" content="2025-09-29" />

<title>Design Effects and Effective Sample Size</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Design Effects and Effective Sample
Size</h1>
<h4 class="author">George Zipf and Richard Valliant</h4>
<h4 class="date">2025-09-29</h4>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<p>Sample size calculation should reflect the complexity of the survey
design by accounting for the weighting, stratification, and clustering
in the survey design. A shortcut method of computing a total sample size
that will yield a target level of precision is to compute a sample size
using a simple random sampling (SRS) formula and then adjust by a design
effect. Design effects may also be of interest to analysts to better
understand how much the standard errors of their estimates are affected
by complex design features.</p>
<p>The <strong>design effect</strong> (<em>deff</em>) is the ratio of
the variance of a survey statistic under the complex design to the
variance of the survey statistic under an SRS. The SRS variance can be
for with- or without-replacement sampling; both usages can be found in
the literature. Represented as a formula, the design effect is: <span class="math display">\[\small deff(\hat{\theta}) =
\frac{V_{complex}(\hat{\theta})}{V_{SRS}(\hat{\theta})}\]</span> where
<span class="math inline">\(\small \hat{\theta}\)</span> is an estimator
of a chosen parameter.</p>
<p>Given a survey dataset, <em>deff</em>’s can be computed directly by
estimating both the complex sample variance and the SRS variance and
taking the ratio. In specific cases, formulas have been derived that
account for different features of sample designs and analysis variables.
Some of these are available in the PracTools package <span class="citation">(Valliant, Dever, and Kreuter 2023)</span>.</p>
<p>A <em>deff</em> is specific to a particular estimator. The
<em>deff</em>’s for estimated mean per capita income and the estimated
proportion of persons who have received the latest coronavirus booster
shot may be quite different even if both come from the same survey.</p>
<p>The <strong>effective sample size</strong> is the sample size for an
estimator <span class="math inline">\(\small \hat{\theta}\)</span> from
a complex sample divided by the design effect of <span class="math inline">\(\small \hat{\theta}\)</span>, i.e. <span class="math inline">\(\small n_{eff}= n/deff(\hat{\theta})\)</span>.</p>
<p>In other words, the effective sample size is the size of an SRS that
would yield the same variance as that produced by the complex design.
For example, if a complex sample of n=1000 elements has a design effect
of 1.25 for some estimate, the effective sample size is <span class="math inline">\(\small n_{eff} = 1000/1.25 = 800\)</span>. That
is, the complex sample of 1000 is only as precise as an SRS of 800 given
the design effect formula implicit in this example. Different design
effect formulas may be derived for different sample designs and
different covariate data, as described below.</p>
<p>This vignette provides an overview on design effect components and
formulas, discusses the PracTools design effect functions that estimate
the design effects and gives examples on when and how to apply them.</p>
<div id="design-effect-components" class="section level2">
<h2>Design Effect Components</h2>
<p>Complex sample variances can be affected by three components:</p>
<ol style="list-style-type: decimal">
<li>Weighting<br />
</li>
<li>Stratification</li>
<li>Clustering</li>
</ol>
<p>In general, clustering increase the design effect (and decrease the
effective sample size) while stratification decreases the design effect.
Weighting can either increase or decrease complex sample variances,
depending on how the weights are derived. Different design effect
formulas applied over these components will result in different final
design effects. These are reviewed below in the context of the design
effect components.</p>
<div id="weighting" class="section level3">
<h3>Weighting</h3>
<p>The most common formula for the weighting component of the design
effect is the one proposed by <span class="citation">Kish (1965)</span>,
where:</p>
<p><span class="math display">\[\small deff_K = 1 + relvar(\mathbf{w}) =
1+ CV^2(\mathbf{w}) = 1 + \frac{1}{n} \sum_{i=1}^n (w_i- \bar{w})^2/
\bar{w}^2,\]</span></p>
<p><span class="math inline">\(\mathbf{w}\)</span> is the vector of
sample weights and <em>relvar</em> denotes relvariance. Kish’s formula
only accounts for an increase in variance due to having unequal weights
and is derived under some extremely restrictive assumptions. It applies
to a stratified, simple random sample (STSRS). If all strata population
variances are equal, a proportional allocation is optimal for estimating
a mean. Since all weights are equal in a proportionally allocated STSRS,
any departure from that where the relvariance of the weights is non-zero
will be suboptimal, leading to <span class="math inline">\(\small deff_K
&gt; 1\)</span>. Practitioners often use Kish’s deff even when the
sample is more complicated than STSRS because <span class="math inline">\(\small deff_K\)</span> is so easy to compute.</p>
<p>However, <span class="math inline">\(\small deff_K\)</span> is not
always relevant in surveys where variances differ across strata, where
subgroups are intentionally sampled at different rates, and/or where
different subgroups have substantially different response rates. Having
unequal weights in those situations is desirable and can more nearly
meet analytic goals than having equal weights will.</p>
</div>
<div id="stratification" class="section level3">
<h3>Stratification</h3>
<p><span class="citation">Chen and Rust (2017)</span> formulate a design
effect that can be broken into the three components listed above. The
Chen-Rust formula for the stratum <span class="math inline">\(\small
h\)</span> component of the design effect is:</p>
<p><span class="math display">\[\small deff_{strat,h} = W_h^2
\frac{n}{n_h}\frac{\sigma_h^2}{\sigma^2}\]</span></p>
<p>where <span class="math inline">\(\small W_h = N_h/N\)</span> and
<span class="math inline">\(\small \sigma^2\)</span> is the population
unit variance. Stratification with an efficient allocation to strata
will reduce the design effect (i.e. increase the effective sample size).
When the sample is allocated optimally over the strata, then the design
effect is necessarily less than or equal to one (<span class="citation">Cochran (1977)</span>, Section 5.6). Stratification is
most effective when the <span class="math inline">\(\small y\)</span>’s
for elements within each strata are homogeneous and the <span class="math inline">\(y\)</span>’s for elements between strata (i.e.,
<span class="math inline">\(\small y\)</span>’s in different strata) are
heterogeneous. As Kish states, the variance decreases “to the degree
that the stratum means diverge and that homogeneity exists within
strata.” (<span class="citation">Kish (1965)</span>, pg. 76). In sum,
good stratification design increases effective sample size.</p>
</div>
<div id="clustering" class="section level3">
<h3>Clustering</h3>
<p>The clustering formula takes into account the variability in each PSU
cluster. The greater the homogeneity of the cluster, the more the design
effect increases. The stratum <span class="math inline">\(\small
h\)</span> formula is:</p>
<p><span class="math display">\[\small deff_{clus,h} = 1 + \rho_h
(n_h^{*}-1) \]</span></p>
<p>where <span class="math inline">\(\small \rho_h\)</span> is the
intraclass correlation coefficient in stratum <span class="math inline">\(h\)</span>, which measures the homogeneity of the
cluster, and <span class="math inline">\(\small n_h^{*}\)</span> is a
type of weighted average number of sampling elements taken from each
cluster. Consequently, clustering typically increases the design effect.
As can be seen, as the homogeneity <span class="math inline">\(\small
\rho\)</span> increases and as cluster sample size <span class="math inline">\(\small n_h^{*}\)</span> increases, the design
effect increases. In some special cases, <span class="math inline">\(\small n_h^{*}\)</span> reduces to the unweighted
average number of sample elements per cluster, <span class="math inline">\(\small \bar{n}\)</span>.</p>
</div>
<div id="combined-formula" class="section level3">
<h3>Combined Formula</h3>
<p><span class="citation">Chen and Rust (2017)</span> combine the above
formulas across strata so that:</p>
<p><span class="math display">\[\small deff = \sum_{h=1}^H
deff_{strat,h} \times deff_{wts,h} \times deff_{clus,h} =  \sum_{h=1}^H
W_h^2 \frac{n}{n_h} \frac{\sigma_h^2}{\sigma^2} [1+ relvar_h
(\mathbf{w})][1 + \rho_h (n_h^{*}-1)]\]</span></p>
<p>where <span class="math inline">\(\small deff_(wts,h) = 1 +
relvar_h(\mathbf{w})\)</span> is the Kish deff for weights within
stratum <span class="math inline">\(\small h\)</span>.</p>
<p>This formula has the advantage that the component parts of the design
effect can be individually calculated and understood. However, as
discussed above, the Kish design effect equal to <span class="math inline">\(1 + relvar(\mathbf{w})\)</span> does not fully
account for the possibility that the estimators may be more efficient
than the relvariance of their weights implies. This is particularly true
for probability proportional to size sampling or for the general
regression estimator.</p>
</div>
</div>
<div id="modeled-design-effect-estimates" class="section level2">
<h2>Modeled Design Effect Estimates</h2>
<p>Several more sophisticated design effects described below have been
developed by later authors. <span class="citation">Spencer (2000)</span>
derived a <em>deff</em> for an estimated total (not means) of <span class="math inline">\(\small y\)</span>’s assuming that the <span class="math inline">\(\small y\)</span> variable can be modeled by the
linear regression model:</p>
<p><span class="math display">\[\small {{y}_{i}}=\alpha +\beta
{{P}_{i}}+{{\varepsilon }_{i}}\]</span></p>
<p>where <span class="math inline">\(\small {{w}_{i}}={1}/{\left(
n{{P}_{i}} \right)}\;\)</span> is the weight for sample element <span class="math inline">\(\small i\)</span> and the <span class="math inline">\(\small \epsilon_i\)</span>’s are independent
errors with mean 0 and common variance. The estimator of the total used
by Spencer was the Horvitz-Thompson estimator (or <span class="math inline">\(\small \pi\)</span>-estimator). Spencer’s design
effect formula then adjusts the design effect of the weights by the
model <span class="math inline">\(\small R^2\)</span>, regression
coefficients, and variance of the model. When the model variance is
large and the <span class="math inline">\(\small R^2\)</span> is low,
Kish’s design effect and Spencer’s design effect are close.</p>
<p><span class="citation">Henry and Valliant (2015)</span> generalized
the <em>deff</em> to a general regression estimator (GREG) that includes
auxiliary variables under the model: <span class="math display">\[\small
{{y}_{i}}=\alpha +\mathbf{x}_{i}^{T}\mathbf{\beta }+{{\varepsilon
}_{i}}\]</span> where <span class="math inline">\(\small
\mathbf{x}_{i}\)</span> is a vector of covariates used in the GREG.</p>
<p>Unlike the Spencer and Henry design effects, the Chen &amp; Rust
design effect (2017) considers clustering but does not account for any
covariates when deriving their <em>deff</em>. The model they assume
includes strata and clustering and is an extension of work by <span class="citation">Gabler, Haeder, and Lahiri (1999)</span>:</p>
<p><span class="math display">\[\begin{equation}
    \small {{E}_{M}}\left( {{y}_{hij}} \right)={{\mu
}_{h}},~~\text{  }Co{{v}_{M}}\left(
{{y}_{hij}},{{y}_{{h}&#39;{i}&#39;{j}&#39;}} \right)=\left\{
\begin{array}{*{35}{l}}
    \sigma _{h}^{2}\qquad \quad h={h}&#39;,i={i}&#39;,j={j}&#39;,  \\
    {{\rho }_{h}}\sigma _{h}^{2}\qquad h={h}&#39;,i={i}&#39;,j\ne
{j}&#39;,  \\
    0\qquad \quad ~~\text{otherwise}.  \\
\end{array} \right.
\end{equation}\]</span></p>
<p>They do provide a useful decomposition of the <em>deff</em> for a
weighted mean estimator into factors due to stratification, clustering,
and unequal weighting that we listed in the <em>Combined Formula</em>
section above.</p>
<p>In sum, the survey practitioner needs to understand the complexity of
the survey design and the potential value in modeling for estimating the
design effect. The above is intended to frame and assist in this
understanding.</p>
</div>
<div id="practools-design-effect-functions" class="section level2">
<h2>PracTools Design Effect Functions</h2>
<p>PracTools has the following design effect functions:
<code>deff</code>, <code>deffCR</code>, <code>deffH</code>,
<code>deffK</code>, and <code>deffS</code>. <code>deff</code> is a
wrapper function in that it calls <code>deffCR</code>,
<code>deffH</code>, <code>deffK</code>, or <code>deffS</code> depending
on the <code>type=</code> option. The following table compares the
PracTools design effect functions:</p>
<table>
<colgroup>
<col width="21%" />
<col width="42%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function name</th>
<th align="left">Parameters</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">deffCR</td>
<td align="left">w = vector of weights for a sample</td>
<td align="left">Chen-Rust design effect for an estimated mean from a
stratified, clustered, two-stage sample. Produces design effects by
weights, strata, and cluster at the strata level and overall.</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">strvar = vector of stratum identifiers</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">clvar = vector of cluster identifiers</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Wh = vector of the proportions of elements that are in
each stratum</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">nest = whether cluster IDs numbered within strata</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">y = vector of sample values of an analysis
variable</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">deffH</td>
<td align="left">w = vector of inverses of selection probabilities for a
sample</td>
<td align="left">Henry design effect for single-stage samples when a
general regression estimator is used for a total.</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">y = vector of the sample values of an analysis
variable</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">x = matrix of covariates used to construct a GREG
estimator of the total</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">deffK</td>
<td align="left">w = vector of weights for a sample</td>
<td align="left">Kish design effect due to unequal weights.</td>
</tr>
<tr class="odd">
<td align="left">deffS</td>
<td align="left">p = vector of 1-draw selection probabilities</td>
<td align="left">Spencer design effect for an estimated total from a
single-stage sample selected by PPS.</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">w = vector of weights for a sample</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">y = vector of the sample values of an analysis
variable</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><strong>Example 1: smho.N874 dataset</strong> PracTools comes with
the <code>smho.N874</code> data set, which is a data frame of 874
observations from the 1998 Survey of Mental Health Organizations (SMHO).
It contains two variables of importance here: EXPTOTAL, which is a
variable of analytic interest, and BEDS, which may be used as a measure
of size in probability proportional to size (PPS) sampling. The
following code is used to create the inputs for <code>deffK</code>,
<code>deffS</code>, and <code>deffH</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## libraries needed for example </span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(PracTools) </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(sampling) </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2) </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## Use PracTools smho.N874 data set </span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">data</span>(smho.N874) </span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## Remove hosp.type == 4 as it is out-patient and has no BEDS </span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>smho <span class="ot">&lt;-</span> smho.N874[smho.N874<span class="sc">$</span>hosp.type <span class="sc">!=</span> <span class="dv">4</span>, ] </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## Use co-variate BEDS for MOS </span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## Re-code BEDS to have a minimum MOS of 5 </span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>smho<span class="sc">$</span>BEDS[smho<span class="sc">$</span>BEDS <span class="sc">&lt;=</span> <span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="dv">5</span> </span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## Create 1-draw probability vector based on BEDS </span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>smho<span class="sc">$</span>pi1 <span class="ot">&lt;-</span> <span class="fu">inclusionprobabilities</span>(smho<span class="sc">$</span>BEDS, <span class="dv">1</span>) </span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="do">## Create vector for sampling n=50 </span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>pik <span class="ot">&lt;-</span> <span class="fu">inclusionprobabilities</span>(smho<span class="sc">$</span>BEDS, <span class="dv">50</span>) </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="do">## Create sample </span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">20230802</span> </span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="fu">set.seed</span>(seed) </span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>sample    <span class="ot">&lt;-</span> <span class="fu">UPrandomsystematic</span>(<span class="at">pik =</span> pik) </span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>smho.samp <span class="ot">&lt;-</span> smho[sample <span class="sc">==</span> <span class="dv">1</span>, ] </span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="do">## Create vector of weights </span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>wgt       <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>pik[sample <span class="sc">==</span> <span class="dv">1</span>] </span></code></pre></div>
<p>The Kish design effect requires just the weights, while the Spencer
requires a vector of sample length for the 1-draw probabilities, the
weights of the sample, and the analytic variable that is regressed on
the 1-draw probabilities.</p>
<pre><code>## Kish 
deffK(wgt) 
[1] 6.263141 
## Spencer 
deffS(p = smho.samp$pi1, 
      w = wgt, 
      y = smho.samp$EXPTOTAL) 
[1] 0.7130517 </code></pre>
<p>As can be seen, Spencer’s <em>deff</em> is substantially below Kish’s
<em>deff</em>, and more crucially, below 1 (i.e. the effective sample
size increases). Spencer’s <em>deff</em> suggests that PPS sampling on
BEDS is more efficient than just simple random sampling for the analytic
variable of interest. On the other hand, the Kish <em>deff</em> is
completely misleading since it says that SRS would be a much more
efficient design. A regression of EXPTOTAL on the 1-draw weights derived
from BEDS confirms this point.</p>
<pre><code>summary(lm(smho$EXPTOTAL ~ smho$pi1)) 
lm(formula = smho$EXPTOTAL ~ smho$pi1) 

Residuals: 
      Min        1Q    Median        3Q       Max  
-67989801  -4123670  -1897337   1655133 138295163  

Coefficients: 
             Estimate Std. Error t value Pr(&gt;|t|)     
(Intercept) 3.628e+06  5.742e+05   6.318 4.62e-10 *** 
smho$pi1    6.144e+09  2.304e+08  26.670  &lt; 2e-16 *** 
--- 
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 
Residual standard error: 12880000 on 723 degrees of freedom 
Multiple R-squared:  0.4959,   Adjusted R-squared:  0.4952  
F-statistic: 711.3 on 1 and 723 DF,  p-value: &lt; 2.2e-16 </code></pre>
<div class="float">
<img role="img" aria-label="Figure 1. Plot of expenditure totals per hospital vs. 1-draw selection probabilities" src="data:image/png;base64,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" alt="Figure 1. Plot of expenditure totals per hospital vs. 1-draw selection probabilities" />
<div class="figcaption">Figure 1. Plot of expenditure totals per
hospital vs. 1-draw selection probabilities</div>
</div>
<p>The plot with a regression line with an intercept shows a fairly
strong relationship and suggests that PPS sampling with respect to BEDS
is efficient. (In this example, a no-intercept model would be a better
fit, but the Spencer deff is derived with the assumption that the model
has an intercept.)</p>
<p>Henry’s design effect uses a matrix of covariates to build the model.
The covariates used below for a GREG estimator of the total of EXPTOTAL
are described in the help file for <code>smho.N874</code>.</p>
<pre><code>## Create matrix of covariates 
x &lt;- cbind(smho.samp$BEDS, 
           smho.samp$SEENCNT, 
           smho.samp$EOYCNT, 
           as.factor(smho.samp$FINDIRCT), 
           as.factor(smho.samp$hosp.type)) 
deffH(w = wgt, 
      x = x, 
      y = smho.samp$EXPTOTAL) 
[1] 0.6549418 </code></pre>
<p>This is consistent with Spencer’s design effect in saying that the
design is more efficient than SRS but also that the GREG estimator is
more efficient than the <span class="math inline">\(\small
\pi\)</span>-estimator.</p>
<p><strong>Example 2: NHANES 2017-2018</strong> The National Health and
Nutrition Examination Survey is a program of studies designed to assess
the health and nutritional status of adults and children in the United
States. While the COVID pandemic caused a break in operations, it has
typically run on a two-year schedule. The data used here are from the
2017 – 2018 NHANES (<a href="https://wwwn.cdc.gov/nchs/nhanes/continuousnhanes/default.aspx?BeginYear=2017" class="uri">https://wwwn.cdc.gov/nchs/nhanes/continuousnhanes/default.aspx?BeginYear=2017</a>}).
The datasets, DEMO_J.XPT, BMX_J.XPT, and BPX_J.XPT, used below can be
downloaded from that site. For the example here, the following code
recreates the data set:</p>
<pre><code>library(haven) 
nhanes.demo &lt;- read_xpt(&quot;C:/NHANES/DEMO_J.XPT&quot;) 
nhanes.bm   &lt;- read_xpt(&quot;C:/NHANES/BMX_J.XPT&quot;) 
nhanes.bp   &lt;- read_xpt(&quot;C:/NHANES/BPX_J.XPT&quot;) 
library(dplyr) 
nhanes.demo &lt;- nhanes.demo %&gt;% select(SEQN, SDMVPSU, SDMVSTRA, WTMEC2YR) 
nhanes.bm   &lt;- nhanes.bm   %&gt;% select(SEQN, BMXHT,   BMXWT,    BMXBMI) 
nhanes.bp   &lt;- nhanes.bp   %&gt;% select(SEQN, BPXSY1,  BPXDI1) 
## Combine data sets 
nhanes      &lt;- inner_join(nhanes.demo, nhanes.bm, by = &quot;SEQN&quot;) 
nhanes      &lt;- inner_join(nhanes,      nhanes.bp, by = &quot;SEQN&quot;) </code></pre>
<p>Using the <code>deffCR</code> function in PracTools on BMXHT
(Standing Height in centimeters):</p>
<pre><code>deffCR(w      = nhanes.na.rm$WTMEC2YR, 
       strvar = nhanes.na.rm$SDMVSTRA, 
       Wh     = NULL, 
       clvar  = nhanes.na.rm$SDMVPSU, 
       nest   = TRUE, 
       y      = nhanes.na.rm$BMXHT)  ## Note: Missing BMXHT values have been removed 

$`strata components` 
      stratum  nh          rhoh     cv2wh   deff.w       deff.c     deff.s 
 [1,]     134 434 -0.0104060072 1.3777530 2.377753 5.358045e-02 0.06902480 
 [2,]     135 548 -0.0063819241 1.2210056 2.221006 1.793669e-01 0.08717926 
 [3,]     136 595 -0.0059338153 1.5680748 2.568075 3.162617e-01 0.06054293 
 [4,]     137 489 -0.0109846523 1.6919849 2.691985 1.156024e-05 0.05199803 
 [5,]     138 543 -0.0078028704 1.4940016 2.494002 1.506828e-01 0.04321209 
 [6,]     139 563 -0.0081864680 1.2916004 2.291600 2.348559e-03 0.06166823 
 [7,]     140 531 -0.0010210084 1.1654563 2.165456 8.755365e-01 0.06117508 
 [8,]     141 609 -0.0067846425 1.1206941 2.120694 3.259820e-02 0.09565024 
 [9,]     142 633 -0.0045075356 0.7718338 1.771834 1.889764e-01 0.13253047 
[10,]     143 459 -0.0083420387 1.2122912 2.212291 1.259705e-01 0.10672679 
[11,]     144 608  0.0043127129 1.5729769 2.572977 1.517876e+00 0.05435944 
[12,]     145 525 -0.0006598233 1.4624627 2.462463 9.296262e-01 0.05791430 
[13,]     146 519 -0.0073484461 0.9075594 1.907559 7.618830e-03 0.09556860 
[14,]     147 513 -0.0099422966 2.2498915 3.249891 1.529503e-01 0.04799347 
[15,]     148 447  0.0064413472 1.1482058 2.148206 1.675286e+00 0.01386007 

$`overall deff` 
[1] 0.7259837 </code></pre>
<p>As the example shows, <code>deffCR</code> provides the design effects
by weights, cluster, and strata, and includes the overall design effect.
As the overall design effect is less than one, the benefits of
stratification are obvious here.</p>
<p>For BMXBMI (Body Mass Index), a very different overall deff is
calculated.</p>
<pre><code>$`strata components` 
      stratum  nh         rhoh     cv2wh   deff.w       deff.c     deff.s 
 [1,]     134 433 -0.011048345 1.3841270 2.384127  0.000807066 0.05788729 
 [2,]     135 547  0.016890014 1.2234169 2.223417  3.164102451 0.07694603 
 [3,]     136 595 -0.005566258 1.5680748 2.568075  0.358614475 0.04902415 
 [4,]     137 487 -0.010918010 1.7022363 2.702236  0.014372671 0.04966114 
 [5,]     138 542  0.002112249 1.4931232 2.493123  1.229605157 0.03612878 
 [6,]     139 562 -0.003298061 1.2890828 2.289083  0.598349310 0.06717454 
 [7,]     140 531 -0.004601001 1.1654563 2.165456  0.439126324 0.06773169 
 [8,]     141 609  0.013328540 1.1206941 2.120694  2.900476535 0.08671762 
 [9,]     142 631 -0.005571733 0.7734050 1.773405  0.002095250 0.14670977 
[10,]     143 458  0.105498156 1.2145247 2.214525 12.012659877 0.09520918 
[11,]     144 608  0.012497688 1.5729769 2.572977  2.500738233 0.06217566 
[12,]     145 524 -0.005311942 1.4622187 2.462219  0.434586798 0.07055294 
[13,]     146 518  0.080413254 0.9046178 1.904618 11.854614598 0.10125102 
[14,]     147 513 -0.008847636 2.2498915 3.249891  0.246211683 0.04876794 
[15,]     148 447  0.018572947 1.1482058 2.148206  2.947117560 0.01564027 

$`overall deff` 
[1] 6.822108 </code></pre>
<p>Here, the design effect is much greater than 1. However, this is
driven largely by high <code>deff.c</code> values in strata 10 and 13.
An advantage to using <code>deffCR</code> is that it allows the
researcher to explore differences in the design effect at the stratum
level and look for unusual situations.</p>
</div>
<div id="design-effect-in-the-survey-package" class="section level2">
<h2>Design Effect in the survey package</h2>
<p>The <code>survey</code> package also calculates design effects, using
the definitional formula given at the beginning of this vignette, <span class="math inline">\(\small deff(\hat{\theta}) =
\frac{V_{complex}(\hat{\theta})}{V_{SRS}(\hat{\theta})}\)</span>, by
directly estimating the numerator and denominator given the input data.
This is a common approach among packages that handle survey data. <span class="math inline">\(\small V_{complex}(\hat{\theta})\)</span> is
calculated using all features of a design (weights, clusters, strata)
while <span class="math inline">\(\small V_{SRS}(\hat{\theta})\)</span>
is an estimate of variance of the same parameter as it would be
estimated from an SRS. While there is other literature available on the
<code>survey</code> package (e.g., see <span class="citation">Lumley
(2010)</span>, <span class="citation">Lumley (2020)</span>), the basics
are illustrated here using the 2017-2018 NHANES data file.</p>
<pre><code>## Call survey library
library(survey)
## Create survey design object
deff.dsn &lt;- svydesign(ids     = ~SEQN,
                      strata  = ~SDMVSTRA,
                      weights = ~WTMEC2YR,
                      nest    = TRUE,
                      data    = nhanes)
## Calculate mean and total for BMI, after removing missing values
## deff=TRUE option provides the design effect
&gt; svymean(~BMXBMI, deff.dsn, na.rm = TRUE, deff=TRUE)
           mean       SE   DEff
BMXBMI 27.67122  0.12744 2.0359
&gt; svytotal(~BMXBMI, deff.dsn, na.rm = TRUE, deff=TRUE)
            total         SE   DEff
BMXBMI 8554169950  125687156 20.723</code></pre>
<p>Note the difference in design effect for the mean and the total,
illustrating that the design effect is specific to the parameter being
estimated. Here, the only difference in the variable is mean vs. total
of BMXBMI. Also, different design effect formulas will yield different
design effect calculations. The Chen-Rust <em>deff</em> of about 6.82
for mean BMXBMI is considerably different from the <code>survey</code>
package <em>deff</em> of 2.04. The Chen-Rust <em>deff</em> is computed
assuming model (1) for <span class="math inline">\(\small y\)</span>
while the survey package directly estimates the <em>deff</em> with no
model assumptions. Since model (1) may be incorrect, the two are not
guaranteed to be equal; both are greater than 1, conveying the point
that the design is less precise than an SRS of the same size would be.
It should be noted that the <code>survey</code> package provides only
the final summary design effect based on the formula above with no
decomposition into components for stratification, clustering, and
weighting.</p>
</div>
<div id="intraclass-correlation-coefficient" class="section level2">
<h2>Intraclass Correlation Coefficient</h2>
<p>Given design effects from previous surveys, the intraclass
correlation coefficient <span class="math inline">\(\small
\rho\)</span>, which measures the homogeneity within clusters, can be
approximated from the formula, <span class="math inline">\(\small
deff_{clus}\left( {\hat{\theta }} \right) = 1 + \rho \left( \bar{n}-1
\right)\)</span>, which comes from the variance for an estimated mean or
total. Solving that equation for gives:</p>
<p><span class="math display">\[\begin{equation}
   \small \rho = \frac{deff_{clus}(\hat{\theta})-1}{\bar{n}-1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\small
deff_{Clus}(\hat{\theta})\)</span> is the cluster design effect for the
estimator <span class="math inline">\(\small \hat{\theta}\)</span> and
<span class="math inline">\(\small \bar{n}\)</span> is the average
number of elements sampled from each cluster. (Note that since an
estimator is also based on a specific <span class="math inline">\(\small
y\)</span>, we could subscript <span class="math inline">\(\small
\rho\)</span> with a <span class="math inline">\(\small y\)</span> to
emphasize that dependence.)</p>
<p><code>deffCR</code> evaluates a more elaborate estimate than
expression (2) of <span class="math inline">\(\small \rho_h\)</span> for
each stratum of a stratified, two-stage design. Consequently, the output
from <code>deffCR</code> (rhoh in the example above) will differ from
values computed from the simpler formula in (2).</p>
<p>Kish suggests a mnemonic for <span class="math inline">\(\small
\rho\)</span>, pronounced “roh”, can be remembered as “rate of
homogeneity,” and observes that in practice, “the distribution of the
population in those clusters is generally not random. Instead, it is
characterized by some homogeneity that tends to increase the variance of
the sample.” The measure of that homogeneity is roh. Because, in a
complex survey, the design effect is typically greater than one,
negative values of roh are uncommon and only occur when the cluster
means are more uniform than random. Also note that even a small positive
roh can have a big impact on the design effect if <span class="math inline">\(\small \bar{n}\)</span> is large.</p>
</div>
<div id="design-effect-and-sample-size-calculations" class="section level2">
<h2>Design Effect and Sample Size Calculations</h2>
<p>Recall that the design effect is computed for a specific estimate.
The design effect for different estimates can be very different, even if
they are from the same sample and use the same weights. When developing
a sample size, it is good to look at the design effects of several of
the variables of interest, and not just one. This is often done using
the design effects from similar or previous surveys.</p>
<p>Looking at the 2017-2018 NHANES data set again, we can calculate the
overall <em>deff</em> for the following estimated means: height (BMXHT),
weight (BMXWT), body mass index (BMXBMI), systolic blood pressure
(BPXSY1), diastolic blood pressure (BPXDI1), and hypertension (BPXSY1
&gt; 130 or BPXDI1 &gt; 80). The following table shows:</p>
<table>
<thead>
<tr class="header">
<th align="left">2017-2018 NHANES Variable</th>
<th align="left">Design Effect (deffCR)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Height</td>
<td align="left">0.7259837</td>
</tr>
<tr class="even">
<td align="left">Weight</td>
<td align="left">3.8322210</td>
</tr>
<tr class="odd">
<td align="left">Body Mass Index</td>
<td align="left">6.8221081</td>
</tr>
<tr class="even">
<td align="left">Systolic Blood Pressure</td>
<td align="left">2.5758779</td>
</tr>
<tr class="odd">
<td align="left">Diastolic Blood Pressure</td>
<td align="left">7.1351104</td>
</tr>
<tr class="even">
<td align="left">Hypertension</td>
<td align="left">2.4553125</td>
</tr>
</tbody>
</table>
<p>As can be seen, there is a lot of variation in the design effects,
even with such related variables as height and weight. The survey
practitioner is advised to calculate design effects on many variables
and get a sense of the overall design effects and potential risks to the
analytic objectives if the sample size is too small for many, but not
all, variables.</p>
<p>Using deffs from earlier surveys can have serious limitations even if
the new sample is for an updated version of the previous one. If the new
design will have different strata or cluster definitions than the last,
<em>deff</em>’s from the previous survey may not apply to the new
design. If response rates in the new sample are likely to be
substantially different from those of the earlier survey, this must also
be considered when determining a sample size. Finally, an overall
<em>deff</em> for a two-stage (or more than two-stage) sample does not
separate the first- and second-stage sample sizes. Additional
calculations are needed for those; e.g., see <span class="citation">Valliant, Dever, and Kreuter (2018)</span>, ch. 9.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Sample size formulas exist which account for the survey design
complexity. (See the vignette, “Selection of Appropriate PracTools
Sample Size Function” at <a href="https://CRAN.R-project.org/package=PracTools" class="uri">https://CRAN.R-project.org/package=PracTools</a>.) While
these sample size formulas can account for design complexities (like
stratification and clustering), they do not typically account for the
effect of weighting. Using a <em>deff</em> to compute a sample size is a
shortcut method to getting the total sample size, but it does not tell
the sample designer how to allocate the sample to strata or to different
stages in a multistage sample. It should be also remembered that the
design effect can vary from one variable to the next. Modeling
approaches to estimating the design effect, as found in <span class="citation">Chen and Rust (2017)</span> and <span class="citation">Henry and Valliant (2015)</span>, may be helpful. The
survey practitioner is advised to use the design-appropriate sample size
formula and compute design effects on important variables and consider
modeling so as to ensure that the effective sample size will meet the
analytic requirements.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Chen.2017" class="csl-entry">
Chen, S., and K. F. Rust. 2017. <span>“An Extension of Kish’s Formula
for Design Effects to Two- and Three-Stage Designs with
Stratification.”</span> <em>Journal of Survey Statistics and
Methodology</em> 5 (2): 111–30.
</div>
<div id="ref-Cochran.1977" class="csl-entry">
Cochran, W. G. 1977. <em>Sampling Techniques</em>. New York: John Wiley
&amp; Sons, Inc.
</div>
<div id="ref-Gabler.1999" class="csl-entry">
Gabler, S., S. Haeder, and P. Lahiri. 1999. <span>“A Model Based
Justification of <span>K</span>ish’s Formula for Design Effects for
Weighting and Clustering.”</span> <em>Survey Methodology</em> 25 (1):
105–6.
</div>
<div id="ref-Henry.2015" class="csl-entry">
Henry, K. A., and R. Valliant. 2015. <span>“A Design Effect Measure for
Calibration Weighting in Single–Stage Samples.”</span> <em>Survey
Methodology</em> 41: 315–31.
</div>
<div id="ref-Kish.1965" class="csl-entry">
Kish, L. 1965. <em>Survey Sampling</em>. New York: John Wiley &amp;
Sons, Inc.
</div>
<div id="ref-Lumley.2010" class="csl-entry">
Lumley, T. 2010. <em>Complex Surveys: A Guide to Analysis Using
<span>R</span></em>. New York: John Wiley &amp; Sons, Inc.
</div>
<div id="ref-Lumley.2020" class="csl-entry">
———. 2020. <em>Survey: Analysis of Complex Survey Samples, Version
4.2-1</em>. <a href="https://CRAN.R-project.org/package=survey">https://CRAN.R-project.org/package=survey</a>.
</div>
<div id="ref-Spencer.2000" class="csl-entry">
Spencer, B. D. 2000. <span>“An Approximate Design Effect for Unequal
Weighting When Measurements May Correlate with Selection
Probabilities.”</span> <em>Survey Methodology</em> 26 (2): 137–38.
</div>
<div id="ref-VDK.2018" class="csl-entry">
Valliant, R., J. A. Dever, and F. Kreuter. 2018. <em>Practical Tools for
Designing and Weighting Survey Samples</em>. 2nd ed. New York:
Springer-Verlag.
</div>
<div id="ref-Valliant.2023" class="csl-entry">
———. 2023. <em>PracTools: Tools for Designing and Weighting Survey
Samples, Version 1.4</em>. <a href="https://CRAN.R-project.org/package=PracTools">https://CRAN.R-project.org/package=PracTools</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
